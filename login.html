<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Flow English</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007bff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Flow English">
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="welcome-heading">
            <h1>üéâ Welcome to Flow in English! Let's learn together!</h1>
        </div>
        <div class="floating-mascot">
            <img src="assets/images/welcome.svg" alt="Welcome Mascot" class="mascot-image">
        </div>
        <div class="login-section">
            <div class="login-icon">
                <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- Book Base -->
                    <rect x="25" y="35" width="70" height="50" rx="8" fill="#4ecdc4" stroke="#2c9a8f" stroke-width="2"/>
                    
                    <!-- Book Pages -->
                    <rect x="27" y="37" width="66" height="46" rx="6" fill="#ffffff"/>
                    
                    <!-- Book Spine -->
                    <rect x="25" y="35" width="8" height="50" rx="4" fill="#2c9a8f"/>
                    
                    <!-- Smiling Face -->
                    <circle cx="45" cy="55" r="3" fill="#333333"/>
                    <circle cx="75" cy="55" r="3" fill="#333333"/>
                    <path d="M 40 65 Q 60 75 80 65" stroke="#333333" stroke-width="2" fill="none" stroke-linecap="round"/>
                    
                    <!-- Pencil -->
                    <rect x="85" y="25" width="4" height="20" rx="2" fill="#ff6b6b"/>
                    <polygon points="85,25 89,25 87,20" fill="#ff6b6b"/>
                    <rect x="86" y="27" width="2" height="16" fill="#ffffff"/>
                    
                    <!-- Notebook Lines -->
                    <line x1="32" y1="70" x2="88" y2="70" stroke="#e0e0e0" stroke-width="1"/>
                    <line x1="32" y1="75" x2="88" y2="75" stroke="#e0e0e0" stroke-width="1"/>
                    <line x1="32" y1="80" x2="88" y2="80" stroke="#e0e0e0" stroke-width="1"/>
                    
                    <!-- Sparkles -->
                    <circle cx="20" cy="30" r="2" fill="#ffd93d"/>
                    <circle cx="100" cy="40" r="1.5" fill="#ffd93d"/>
                    <circle cx="15" cy="85" r="1.5" fill="#ffd93d"/>
                    <circle cx="105" cy="75" r="2" fill="#ffd93d"/>
                    
                    <!-- Decorative Elements -->
                    <circle cx="60" cy="90" r="3" fill="#4ecdc4" opacity="0.6"/>
                    <circle cx="35" cy="90" r="2" fill="#ff6b6b" opacity="0.6"/>
                    <circle cx="85" cy="90" r="2" fill="#45b7d1" opacity="0.6"/>
                </svg>
            </div>
            <div class="login-card">
            <h1>Welcome to Flow English</h1>
            <form id="loginForm">
                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
            </form>
        </div>
        </div>
        <div class="inspiration-message">
            <p>üåç Learning English opens the world. You've got this!</p>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script src="sw-register.js"></script>
    
    <script type="module">
        import { auth, db } from './firebase-config.js';
        import { signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';
        import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';

        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = usernameInput.value.trim();
            const password = passwordInput.value;

            // Check for admin login
            if (username === 'Tamar' && password === '1983') {
                window.location.href = 'admin.html';
                return;
            }

            try {
                // Convert username to email
                const email = username + '@flow.com';
                
                // Sign in with Firebase Auth
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Fetch user role from Firestore
                const userDocRef = doc(db, 'users', user.uid);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const role = userData.role;

                    // Redirect based on role
                    if (role === 'student') {
                        window.location.href = 'student.html';
                    } else if (role === 'teacher') {
                        window.location.href = 'teacher.html';
                    } else {
                        alert('Invalid user role. Please contact administrator.');
                    }
                } else {
                    alert('User data not found. Please contact administrator.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please check your credentials and try again.');
            }
        });
    </script>
</body>
</html> 